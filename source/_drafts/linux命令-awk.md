---
title: linux命令-awk
tags: awk
categories: linux
---
# 语法
* awk 选项 -f 程序文件 源文件
* awk 选项 程序文本 源文件

## 选项
* -f awk程序文件
* -F 定义分隔符【FS】
* -v var=val 定义变量【定义程序执行前的变量】
* -e awk程序文本【可省略】

## awk程序
* 格式：pattern { action }
* 执行顺序
    - 命令行-v指定的变量
    - BEGIN指定的规则
    - 处理命令行下引用的每一个源文件【ARGV方式调用】
    - 使用pattern匹配每一个record，匹配成功则执行actions
    - 所有record处理完成后执行END规则

# 变量记录和字段
## 记录
* 记录通常由换行符分隔【也即一行内容为一个记录】，也可以由内置变量RS定义分隔符
* 只有单字符或正则表达式可以作为分隔符
* 如果RS设置空，则由空行(\n\n)作为记录分隔符；此时，换行符(\n)作为域分隔符【FS】

## 字段
* 默认使用空格分隔记录为多个字段
* 使用FS定义字段分隔符，FS可以是单字符或正则表达式
* 如果设定FIELDWIDTHS，即每个字段相同宽度，则会覆盖FS设置
* 记录中的每个字段都可以使用$1,$2...进行引用，$0表示整个记录记录，不能使用负数进行字段引用
* 变量NF表示记录中的总字段数
* 引用不存在的字段将会产生空字符串

## 内置变量
* ARGC：命令行参数数量
* ARGV：命令行参数数组
* ENVIRON：环境变量数组
* FIELDWIDTHS：固定宽度分隔字段
* FILENAME：当前输入的文件名，在BEGIN阶段则是未定义
* FNR：当前处理的记录所在行号
* FS：输入字段分隔符【默认空格】
* NF：输入记录的字段总数
* NR：到目前为止的输入记录总数
* OFMT：数字输出格式，默认"%.6g"
* OFS：输出字段分隔符【默认空格】
* ORS：输出记录分隔符【默认换行符】
* RS：输入记录分隔符【默认换行符】

# 模式和行为
* awk是面向行的语言，先是模式(pattern)，后是行为(action)【行为包含在花括号中】
* pattern或action其中之一可能不存在，但不可能出现二者都缺失的情况
* 假如pattern缺失，则action应用于每一行记录
* 如果action缺失，则相当于action是{print}【即打印整行记录】
* 可以使用分号分隔pattern-action中的action的多条语句，或者分隔pattern-actions本身

## pattern
