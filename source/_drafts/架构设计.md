---
title: 架构设计
tags:
categories:
---
# 架构设计目标
* 可伸缩性（Scalability），当服务的负载增长时，系统能被扩展来满足需求，且不降低服务质量。
    - 负载均衡技术是实现网站架构伸缩性的主要手段
* 高可用性（Availability），尽管部分硬件和软件会发生故障，整个系统的服务必须是每天24小时每星期7天可用的。
* 可管理性（Manageability），整个系统可能在物理上很大，但应该容易管理。
* 价格有效性（Cost-effectiveness），整个系统实现是经济的、易支付的。

# 负载均衡技术
* 基于客户端调度访问：客户端存储服务器集群配置信息，当有请求时，通过算法向不同服务器发送请求【redis的集群即使用此方法，redis的客户端需要存储redis集群的ip及端口列表】
* 基于DNS域名轮流解析：一个域名映射多个服务器
* 基于应用层系统负载调度：nginx、haproxy
* 基于网络及传输层的IP地址调度：lvs、haproxy

# 阿里云高可用
* 同一个城市的多个可用区网络互通，用户无感知
* 为了保证应用的高可用，应该在不同可用区部署服务
* rds的主库默认会在同一可用区建立备库（用户不可见，主库故障时，rds自动切换），用户可购买不同可用区的容灾备

# 架构层次设计
* 缓存服务【CDN】
* 负载均衡器
* web服务
* 应用层服务
* 数据库

# 高并发实现
* 应用层横向扩展
    - 负载均衡器（四层/七层实现）
    - 弹性伸缩服务（动态增减服务器容量）
* 使用应用层缓存（如memcache、redis服务等key-value服务）
* 同步转异步（消息队列）
* 提供数据库访问能力（读写分离）

## 应用层缓存
* 原因：数据库服务横向扩展支持高并发
* 特点
    - key-value存储
    - 内存中缓存数据
    - 支持热点数据缓存
    - 数据访问速度要求高
    - 更新评率低，读取频率高
* 产品
    - memcache：数据不存盘
    - redis：数据存盘

## 同步转异步
* 重点：业务流程设计中拆分出同步和异步
* 两种模式：
    - 同步：支付要求实时返回信息
    - 异步：消息队列
* 消息队列：
    - 生产者
    - 消息平台【存储、路由】
    - 消费者

## 数据库架构
* 读写分离原因
    - 写操作严格，并发不高
    - 由于写操作加锁原因，会影响读操作，间接造成读操作并发不高
    - 写操作频率一般比读操作频率低很多
* 读写分离操作
    - 读写操作拆分到不同数据库实例上，由于磁盘io限制，一般也要求数据库实例分布在不同主机上
    - 读写分离关键：复制技术（一般才去日志重做机制-redo）
* 读写分离应用：能够接受读写操作微小的延迟和不一致
