---
title: linux系统原理-文件系统
tags:
categories:
---
# 文件类型
>以ls -l命令的输出的第一个符号为区别标志，其中字符设备、块设备、FIFO文件可使用mknod命令创建

* 普通文件：首字符显示为"-"，如：`-rw-rw-r-- 1 muker muker 135522 Jul 18 13:17 lsof.txt`【lsof.txt文件】
* 目录：首字符显示为“d”，如：`drwxrwxr-x  7 muker muker  4096 Jun 21 17:31 roles/`【roles目录】
* 符号链接：首字符显示为"l"，表示软连接，如：`lrwxrwxrwx. 1 root root 7 Oct 15  2017 /bin/python -> python2`
* 套接字文件：首字符显示为“s”，用于网络通信，如`srwx------ 1 root root 0 May 22 14:33 /var/run/supervisor/supervisor.sock`【supervisor程序的socket文件】
* 字符设备文件：首字符显示为”c“，表示串行端口设备，如：`crw--w---- 1 muker tty 136, 0 Jul 19 09:16 /dev/pts/0`【表示pts远程虚拟终端】
* 块设备文件：首字符显示为”b“，表示提供存储功能的设备，如：`brw-rw---- 1 root disk 253, 0 May 22 17:12 /dev/vda`【vda磁盘】
* FIFO文件(命名管道文件)：首字符显示为“p”，区别于“|”这种无名管道(管道运行完即销毁，同时也是单向通道)，FIFO这种方式为双向通道，任何程序任何时间都可以通过此管道进行双向通信

# 软链接与硬链接
* 实质：
    - 软链接是新建一个文件（软链接使用不同于源文件的新inode号），文件内容记录源文件或目录的路径信息，相当于windows的快捷方式
    - 硬链接相当于为文件建立一个新的索引别名（硬链接和源文件使用相同的inode号），源文件和硬链接除了名称不一样外，其他属性信息完全相同
* 不能对目录建立硬链接，也不能跨文件系统对文件建立硬链接
* 可以在同一文件系统或跨文件系统，对目录或文件建立软链接
* 删除源文件，软链接失效，硬链接依然可以显示文件内容
* 生产现场经常使用软链接【相对硬链接限制更少】；而许多硬件设备的快照功能则类似硬链接

# 文件删除
* 原理：linux系统对文件的删除是通过控制文件的link数达到的，而link数主要由i_nlink（硬链接数，磁盘引用次数）和i_count（文件被进程调用的次数，内存引用次数），只有当这两个数值同时为0时，文件（确切的说是文件名及相应的inode）才从文件系统中消失。但此时若无新数据写入或系统未执行磁盘检查收回空间，数据还是可以找回的
* 删除条件：
    - 硬链接都被删除（i_nlink为0）
    - 没有被进程调用（i_count）
    - 实际存储空间没有被覆盖或回收
* 范例：磁盘幽灵空间
    + 现象：df与du统计相差巨大
    + 原因：文件被删除，但是使用这些文件的进程还在，造成空间不能释放
    + 解决：使用 lsof|grep deleted 查看占用删除文件的进程，重启或删除相关进程
* 范例：web服务日志写满磁盘，删除日志后，磁盘空间依然充满未被释放；此时重启apache服务，磁盘空间释放，日志可重新写入。
  
# 根目录
* sbin：放置设备管理命令，一般只能root账号运行
* bin：放置系统管理命令，一般用户可以使用
* dev：设备文件目录
* etc：配置文件目录、服务控制脚本
* boot：开机管理程序grub、内核kernel、initrd存放目录
* mnt/media：设备、镜像挂载目录
* lib/lib64：库文件目录
* home/root：用户家目录
* tmp：临时文件目录
* proc：系统运行产生的信息，不占用磁盘
* sys：与proc类似，主要记载与核心有关的信息，不占用磁盘
* opt/srv
* run
* usr：用户级配置信息
* var：存储内容会一直变化的内容，如log、pid等

# 目录
* 逻辑上，所有目录都挂载在根目录下
* 不同目录可以挂载在不同设备和分区

# 分区
由于开机过程只加载根分区，所有/bin:/sbin:/lib:/dev:/etc必须和根目录在同一个分区

# 格式化

# 文件共享
* ftp
* samba
* nfs
* autofs

# 文件同步
* rsync
* inotify
* union
