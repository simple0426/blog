---
title: mysql介绍
tags:
categories:
---
# 版本
* mysql-5.5
* mysql-5.6【牧客，测试环境版本：5.6.43】
* mysql-5.7【中冀汇通，全环境版本：5.7.17】
* mariadb
* mysql-8.0

# 下载地址
* mysql相关资源下载目录：https://www.mysql.com/products/community/
* 社区版server下载地址：https://dev.mysql.com/downloads/mysql/

# 存储引擎
## 查看
* 查看支持的存储引擎：show engines;【常见引擎如下】
    - MyISAM：mysql库user表
    - csv：mysql库log类表
    - InnoDB：其他库表及新建库表的默认存储引擎
* 查看当前的存储引擎选项：show variables like '%engine%';
* 查看表的存储引擎：show create table tb_name;

## 设置与修改
* alter table table_name engine=innodb；
* 将表结构导出使用sed替换，将数据导出，再将表结构导入，数据导入
* 使用mysql_convert_table_format命令
* 建表时使用engine=innodb参数

## InnoDB与MyISAM对比
|            MyISAM            |                InnoDB                |
|------------------------------|--------------------------------------|
| 不支持事务                   | 支持事务、分区、表空间               |
| 写操作时表级别锁定           | 写操作时行级别锁定                   |
| 只缓存索引                   | 缓存索引和数据                       |
| 读操作会阻塞写操作           | 读写操作相对独立【根据事务隔离级别】 |
| 支持全表索引，不支持外键约束 | 支持外键约束，不支持全表索引         |

## MyISAM
* 文件存储：每一个myisam表对应于硬盘上的3个文件。这三个文件有一样的文件名，但是有不同的扩展名以指示其用途：
    - frm文件保存表的定义，但这个文件不是myisam引擎的一部分，而是服务器的一部分
    - MYD(data)：保存表的数据
    - MYI(index)：表的索引文件
* 应用：
    - 并发较低的业务
    - 以读为主的业务
    - 不需要事务支持的业务
* 优化：
    - 尽量索引及使用缓存
    - 尽量顺序操作将数据插入尾部
    - 分解复杂操作，延迟写入，批量插入
    - 降低并发数，高并发应用引入排队机制

## InnoDB
* 应用：
    - 支持高并发，但需要确保查询时通过索引完成
    - 支持事务
    - 数据更新频繁
* 优化：
    - 避免全表扫描，因为会使用表锁
    - 尽可能缓存所有索引和数据，提高响应速度，降低磁盘io
    - 在大批量小插入时，尽量自己控制事务而不要使用autocommit自动提交
    - 合理设置innodb_flush_log_at_trx_commit参数值，不要过度追求安全性
    - 避免主键更新，因为这会带来大量的数据移动
    - 主键尽可能小，避免给secondary index带来过大的空间负担
* 事务隔离级别【默认REPEATABLE-READ，可重复读】

|     隔离级别     |                       描述                       |                           解决的问题                           |                    引发的新问题                    |
|------------------|--------------------------------------------------|----------------------------------------------------------------|----------------------------------------------------|
| read committed   | 读取提交的记录                                   | 脏读：一个事务读取了另外一个事务未提交的数据                   | 不可重复读                                         |
| repeatable read  | 可重复读：一个事务中，每次读取到的数据都是一致的 | 不可重复读：一个事务读取表中的某一行数据时，多次读取结果不一致 | -                                                  |
| serializable     | 串行读取数据                                     | 虚读：前后读取到表中的记录数不一样，读取到了其他事务插入的数据 | 数据库就变成了单线程访问的数据库，导致性能降低很多 |
| read uncommitted | 读取到了未提交的数据                             | -                                                              | 读取到的数据不一致                                 |
